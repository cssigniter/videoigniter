var VideoIgniter=function(){var e=jQuery;if(vi_scripts){var t={$trackContainer:e(".vi-fields-container"),trackFieldClassName:".vi-field-repeatable",$addTrackButtonTop:e(".vi-add-field-top"),$addTrackButtonBottom:e(".vi-add-field-bottom"),removeFieldButtonClassName:".vi-remove-field",$removeAllTracksButton:e(".vi-remove-all-fields"),$batchUploadButton:e(".vi-add-field-batch"),videoUploadButtonClassName:".vi-track-url-upload",fieldTitleClassName:".vi-field-title",trackTitleClassName:".vi-track-title",trackDescriptionClassName:".vi-track-description",trackUrlClassName:".vi-track-url",fieldHeadClassName:".vi-field-head",fieldCollapsedClass:"vi-collapsed",customElements:"vi-subtitles-field,vi-overlays-field",$expandAllButton:e(".vi-fields-expand-all"),$collapseAllButton:e(".vi-fields-collapse-all"),$shortcodeInputField:e("#vi_shortcode")};return t.$trackContainer.on("click",t.fieldHeadClassName,(function(n){var s=e(this).parents(t.trackFieldClassName);i(s)?l(s):a(s),n.preventDefault()})),t.$expandAllButton.on("click",(function(i){l(e(this).closest(".vi-container").find(".vi-fields-container").find(t.trackFieldClassName)),i.preventDefault()})),t.$collapseAllButton.on("click",(function(i){a(e(this).closest(".vi-container").find(".vi-fields-container").find(t.trackFieldClassName)),i.preventDefault()})),t.$trackContainer.on("keyup",t.trackTitleClassName,(function(){var i=e(this);i.parents(t.trackFieldClassName).find(t.fieldTitleClassName).text(i.val())})),t.$addTrackButtonTop.on("click",(function(){var t=e(this).closest(".vi-container").find(".vi-fields-container");t.prepend(r(void 0,t))})),t.$addTrackButtonBottom.on("click",(function(){var t=e(this).closest(".vi-container").find(".vi-fields-container");t.append(r(void 0,t))})),t.$trackContainer.on("click",t.removeFieldButtonClassName,(function(){d(e(this).parents(".vi-field-repeatable"))})),t.$removeAllTracksButton.on("click",(function(){var i=e(this).closest(".vi-container").find(".vi-fields-container").find(t.trackFieldClassName);window.confirm(vi_scripts.messages.confirm_clear_tracks)&&(i.length>1?(d(i.slice(1)),s(i)):s(i))})),t.$trackContainer.on("click",t.videoUploadButtonClassName,(function(){var i=e(this).parents(t.trackFieldClassName);c({handler:"vi-video",title:vi_scripts.messages.media_title_upload,type:"video",onMediaSelect:function(e){o(i,e)}})})),t.$shortcodeInputField.on("click",(function(){e(this).select()})),{elements:t,collapseField:a,expandField:l,isFieldCollapsed:i,isTrackFieldEmpty:function(t){var i=!0;return t.find("input").each((function(){e(this).val()&&(i=!1)})),i},resetField:s,resetCoverImage:n,getNewTrackField:r,removeElement:d,populateTrackField:o,wpMediaInit:c,uuid:u}}function i(e){return e.hasClass(t.fieldCollapsedClass)}function a(e){e.addClass(t.fieldCollapsedClass)}function l(e){e.removeClass(t.fieldCollapsedClass)}function n(e){const t=e.find("vi-image-field").get(0);t&&t.clear()}function s(i,a){var s=i.data("uid"),r=a||u();i.attr("data-uid",r),i.find("input, textarea, select").not(":button").each((function(){var t=e(this);t.attr("id")&&t.attr("id",t.attr("id").replace(s,r)),t.attr("name")&&t.attr("name",t.attr("name").replace(s,r)),t.val("")})),i.find("label").each((function(){var t=e(this);t.attr("for",t.attr("for").replace(s,r))})),i.find(t.fieldTitleClassName).text(""),i.find(t.customElements).remove(),i.find("vi-repeatable-fields").each((function(){var t=e(this);t.attr("data-name",t.data("name").replace(s,r))})),l(i),n(i)}function r(e,i){var a=e||u(),l=(i||t.$trackContainer).find(t.trackFieldClassName).first().clone().hide().show();return s(l,a),l}function d(t,i){t.fadeOut("fast",(function(){e(this).remove(),i&&"function"==typeof i&&i()}))}function o(e,i){var a=e.find(t.trackUrlClassName),l=e.find(t.trackTitleClassName),n=e.find(t.trackDescriptionClassName),s=e.find(t.fieldTitleClassName);i.url&&a.val(i.url),i.title&&""===l.val()&&(l.val(i.title),s.text(i.title)),i.meta&&i.meta.description&&""===n.val()&&n.val(i.meta.description)}function c(e){if(!e.handler)throw new Error("Missing `handler` option");var t=e.multiple||!1,i=e.title||"Select media",a=wp.media.frames[e.handler];a?a.open():((a=wp.media({title:i,multiple:t,library:{type:e.type}})).open(),a.on("select",(function(){var i,l=a.state().get("selection");i=t?l.map((function(e){return e.toJSON()})):l.first().toJSON(),e.onMediaSelect&&"function"==typeof e.onMediaSelect&&e.onMediaSelect(i)})))}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}}();window.VideoIgniter||(window.VideoIgniter=VideoIgniter);class VideoIgniterImageField extends HTMLElement{constructor(){super(),this.elements={triggerElement:this.querySelector(".vi-field-image-upload"),dismissElement:this.querySelector(".vi-field-image-upload-dismiss"),image:this.querySelector("img"),placeholder:this.querySelector(".vi-field-image-placeholder"),input:this.querySelector("input")},this.changeEvent=new Event("change",{bubbles:!0,cancelable:!0})}connectedCallback(){this.elements.triggerElement.addEventListener("click",(e=>{e.preventDefault(),this.handleMediaUpload()})),this.elements.dismissElement.addEventListener("click",(e=>{e.preventDefault(),e.stopImmediatePropagation(),this.clear()})),this.elements.input.value&&this.populateData()}handleMediaUpload(){VideoIgniter.wpMediaInit({handler:"vi-upload-image",title:vi_scripts.messages.media_title_upload_file,type:"image",onMediaSelect:e=>{this.populateData(e.id,e.url)}})}populateData(e,t){null!=e&&(this.elements.input.value=e,this.elements.input.dispatchEvent(this.changeEvent)),t&&(this.elements.image.src=t),this.elements.placeholder.style.display="none",this.elements.dismissElement.style.display="block",this.elements.image.style.display="inline-block"}clear(){this.elements.input.value="",this.elements.placeholder.style.display="block",this.elements.dismissElement.style.display="none",this.elements.image.style.display="none"}}customElements.define("vi-image-field",VideoIgniterImageField);class VideoIgniterFileUploadField extends HTMLElement{constructor(){super(),this.elements={input:this.querySelector("input"),button:this.querySelector("button")},this.mimeType=this.dataset.mimeType,this.changeEvent=new Event("change",{bubbles:!0,cancelable:!0})}connectedCallback(){this.elements.button.addEventListener("click",(()=>{this.handleMediaUpload()}))}handleMediaUpload(){VideoIgniter.wpMediaInit({handler:"vi-file-upload",title:vi_scripts.messages.media_title_upload_file,type:this.mimeType||void 0,onMediaSelect:e=>{this.elements.input.value=e.url,this.elements.input.dispatchEvent(this.changeEvent)}})}}customElements.define("vi-file-upload-field",VideoIgniterFileUploadField);class VideoIgniterRepeatableFields extends HTMLElement{constructor(){super()}connectedCallback(){this.component=this.dataset.component,this.dataName=this.dataset.name,this.container=this.querySelector(".vi-repeatable-fields-content"),this.addEventListener("click",(e=>{e.target.classList.contains("vi-fields-add-button")&&this.addField()})),this.createDataInput()}addField(){const e=document.createElement(this.component);this.container.appendChild(e)}createDataInput(){const e=document.createElement("input");e.type="hidden",e.name=this.dataName,this.appendChild(e),this.input=e}serializeData(){const e=[...this.container.querySelectorAll(this.component)].map((e=>[...[...e.querySelectorAll("input, textarea, select")].filter((e=>e!==this.input))].reduce(((e,t)=>("checkbox"===t.type&&t.checked?e[t.getAttribute("name")]="1":e[t.getAttribute("name")]=t.value,e)),{})));this.input.value=JSON.stringify(e)}}customElements.define("vi-repeatable-fields",VideoIgniterRepeatableFields);class VideoIgniterRepeatableField extends HTMLElement{constructor(){super();try{this.data=JSON.parse(this.dataset.data)}catch{this.data=null}}connectedCallback(){this.parent=this.closest("vi-repeatable-fields");const e=document.getElementById(this.getTemplateId()).content;this.appendChild(document.importNode(e,!0)),this.makeUnique(),this.populateData(),this.parent.serializeData(),this.querySelector(".vi-fields-remove-button").addEventListener("click",(()=>{this.remove(),this.parent.serializeData()})),this.querySelectorAll("input, textarea, select").forEach((e=>{e.addEventListener("change",(()=>{this.parent.serializeData()}))}))}makeUnique(){const e=VideoIgniter.uuid();this.querySelectorAll("input, textarea, select, label").forEach((t=>{["id","for","name"].forEach((i=>{t.getAttribute(i)&&t.setAttribute(i,t.getAttribute(i).replace("{uid}",e))}))}))}getTemplateId(){return""}populateData(){if(!this.data)return;this.querySelectorAll("input, textarea, select").forEach((e=>{const t=this.data[e.getAttribute("name")];if(null!=t){if("checkbox"===e.type&&"1"===t)return void(e.checked="true");e.value=t}}))}}