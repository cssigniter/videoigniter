/*! @name videojs-playlist @version 5.0.0 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsPlaylist=t(e.videojs)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e);let n=e=>{const t=e.playlist.autoadvance_;t.timeout&&e.clearTimeout(t.timeout),t.trigger&&e.off("ended",t.trigger),t.timeout=null,t.trigger=null};const l=(e,t)=>{var r;(n(e),"number"==typeof(r=t)&&!isNaN(r)&&r>=0&&r<1/0)?(e.playlist.autoadvance_.delay=t,e.playlist.autoadvance_.trigger=function(){const r=()=>l(e,t);e.one("play",r),e.playlist.autoadvance_.timeout=e.setTimeout((()=>{n(e),e.off("play",r),e.playlist.next()}),1e3*t)},e.one("ended",e.playlist.autoadvance_.trigger)):e.playlist.autoadvance_.delay=null},i=e=>!!e&&"object"==typeof e,a=(e,t)=>{let r=e,n=t;return"object"==typeof e&&(r=e.src),"object"==typeof t&&(n=t.src),/^\/\//.test(r)&&(n=n.slice(n.indexOf("//"))),/^\/\//.test(n)&&(r=r.slice(r.indexOf("//"))),r===n},o=(e,t)=>{for(let r=0;r<e.length;r++){const n=e[r].sources;if(Array.isArray(n))for(let e=0;e<n.length;e++){const l=n[e];if(l&&a(l,t))return r}}return-1};function s(e,t,a=0){let s=null,u=!1;const c=e.playlist=(t,r=0)=>{if(u)throw new Error("do not call playlist() during a playlist change");if(Array.isArray(t)){const n=Array.isArray(s)?s.slice():null,l=t.slice();s=l.slice(),s.filter((e=>i(e))).length!==s.length&&(s=(e=>{const t=[];let r;return e.forEach((e=>{i(e)?r=e:(r=Object(e),r.originalValue=e),t.push(r)})),t})(s)),(e=>{let t=1;e.forEach((e=>{e.playlistItemId_=t++}))})(s),u=!0,e.trigger({type:"duringplaylistchange",nextIndex:r,nextPlaylist:l,previousIndex:c.currentIndex_,previousPlaylist:n||[]}),u=!1,-1!==r&&c.currentItem(r),n&&e.setTimeout((()=>{e.trigger("playlistchange")}),0)}return s.map((e=>e.originalValue||e)).slice()};return e.on("loadstart",(()=>{-1===c.currentItem()&&n(e)})),c.currentIndex_=-1,c.player_=e,c.autoadvance_={},c.repeat_=!1,c.currentPlaylistItemId_=null,c.currentItem=e=>{if(u)return c.currentIndex_;if("number"==typeof e&&c.currentIndex_!==e&&e>=0&&e<s.length)return c.currentIndex_=e,((e,t)=>{const r=!e.paused()||e.ended();e.trigger("beforeplaylistitem",t.originalValue||t),t.playlistItemId_&&(e.playlist.currentPlaylistItemId_=t.playlistItemId_),e.poster(t.poster||""),e.src(t.sources),(e=>{const t=e.remoteTextTracks();let r=t&&t.length||0;for(;r--;)e.removeRemoteTextTrack(t[r])})(e),e.ready((()=>{if((t.textTracks||[]).forEach(e.addRemoteTextTrack.bind(e)),e.trigger("playlistitem",t.originalValue||t),r){const t=e.play();void 0!==t&&"function"==typeof t.then&&t.then(null,(e=>{}))}l(e,e.playlist.autoadvance_.delay)}))})(c.player_,s[c.currentIndex_]),c.currentIndex_;const t=c.player_.currentSrc()||"";if(c.currentPlaylistItemId_){const e=((e,t)=>{for(let r=0;r<e.length;r++)if(e[r].playlistItemId_===t)return r;return-1})(s,c.currentPlaylistItemId_),r=s[e];if(r&&Array.isArray(r.sources)&&o([r],t)>-1)return c.currentIndex_=e,c.currentIndex_;c.currentPlaylistItemId_=null}return c.currentIndex_=c.indexOf(t),c.currentIndex_},c.contains=e=>-1!==c.indexOf(e),c.indexOf=e=>{if("string"==typeof e)return o(s,e);const t=Array.isArray(e)?e:e.sources;for(let e=0;e<t.length;e++){const r=t[e];if("string"==typeof r)return o(s,r);if(r.src)return o(s,r.src)}return-1},c.currentIndex=()=>c.currentItem(),c.lastIndex=()=>s.length-1,c.nextIndex=()=>{const e=c.currentItem();if(-1===e)return-1;const t=c.lastIndex();return c.repeat_&&e===t?0:Math.min(e+1,t)},c.previousIndex=()=>{const e=c.currentItem();return-1===e?-1:c.repeat_&&0===e?c.lastIndex():Math.max(e-1,0)},c.first=()=>{if(u)return;const e=c.currentItem(0);if(s.length)return s[e].originalValue||s[e];c.currentIndex_=-1},c.last=()=>{if(u)return;const e=c.currentItem(c.lastIndex());if(s.length)return s[e].originalValue||s[e];c.currentIndex_=-1},c.next=()=>{if(u)return;const e=c.nextIndex();if(e!==c.currentIndex_){const t=c.currentItem(e);return s[t].originalValue||s[t]}},c.previous=()=>{if(u)return;const e=c.previousIndex();if(e!==c.currentIndex_){const t=c.currentItem(e);return s[t].originalValue||s[t]}},c.autoadvance=e=>{l(c.player_,e)},c.repeat=e=>void 0===e?c.repeat_:"boolean"==typeof e?(c.repeat_=!!e,c.repeat_):void r.default.log.error("videojs-playlist: Invalid value for repeat",e),c.sort=t=>{s.length&&(s.sort(t),u||e.trigger("playlistsorted"))},c.reverse=()=>{s.length&&(s.reverse(),u||e.trigger("playlistsorted"))},c.shuffle=({rest:t}={})=>{let r=0,n=s;t&&(r=c.currentIndex_+1,n=s.slice(r)),n.length<=1||((e=>{let t=-1;const r=e.length-1;for(;++t<e.length;){const n=t+Math.floor(Math.random()*(r-t+1)),l=e[n];e[n]=e[t],e[t]=l}})(n),t&&s.splice(...[r,n.length].concat(n)),u||e.trigger("playlistsorted"))},Array.isArray(t)?c(t.slice(),a):s=[],c}const u=function(e,t){s(this,e,t)};return(r.default.registerPlugin||r.default.plugin)("playlist",u),u.VERSION="5.0.0",u}));
