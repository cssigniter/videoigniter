class ChapterTimeline extends(videojs.getComponent("Component")){constructor(e,t={}){super(e,t),t.left&&t.width&&this.setPosition(t.left,t.width)}createEl(){const e=videojs.dom.createEl("div",{className:"vjs-chapter-timeline"}),t=videojs.dom.createEl("div",{className:"vjs-chapter-timeline-progress"});return e.append(t),e}setPosition(e,t){this.el().style.left=e,this.el().style.width=t}updateProgress(e){this.el().querySelector(".vjs-chapter-timeline-progress").style.width=`${e}%`}}function chaptersTimeline(){const e=this,t=()=>{const[t]=Array.from(e.textTracks()).filter((e=>"chapters"===e.kind))??[];return t},r=()=>{const r=e.getChild("controlBar").getChild("progressControl").getChild("seekBar").getChild("mouseTimeDisplay").getChild("timeTooltip");r.update=function(o,s,i){const l=(e=>{const r=t(),o=r?.cues;if(o)return Array.from(o).find((t=>e>=t.startTime&&e<=t.endTime))})(s*e.duration());l?(r.el().classList.add("vjs-time-tooltip-with-chapter-title"),r.el().innerHTML=`<span class="vjs-time-tooltip-chapter-title">${l.text}</span>${i}`):(r.write(i),r.el().classList.remove("vjs-time-tooltip-with-chapter-title")),r.el().style.transform="translateX(-50%)",r.el().style.right="auto"}},o=r=>{const o=e.getChild("controlBar").getChild("progressControl"),s=e.getChild("controlBar").getChild("progressControl").getChild("seekBar").calculateDistance(r)*e.duration(),i=t(),l=i?.cues,n=o.el().querySelectorAll(".vjs-chapter-timeline");l&&Array.from(l).forEach(((e,t)=>{const r=n[t];r&&(s>=e.startTime&&s<=e.endTime?r.classList.add("vjs-chapter-timeline-current"):r.classList.remove("vjs-chapter-timeline-current"))}))},s=()=>{const t=e.getChild("controlBar").getChild("progressControl");t.el().querySelectorAll(".vjs-chapter-timeline")?.forEach((e=>{e.classList.remove("vjs-chapter-timeline-current")}))},i=()=>{const r=e.currentTime(),o=t(),s=o?.cues;if(!s)return;const i=e.getChild("controlBar").getChild("progressControl").el().querySelectorAll(".vjs-chapter-timeline");Array.from(s).forEach(((e,t)=>{const o=i[t];if(o){const t=o.querySelector(".vjs-chapter-timeline-progress");if(r>=e.endTime)t.style.width="100%";else if(r>=e.startTime&&r<=e.endTime){const o=(r-e.startTime)/(e.endTime-e.startTime)*100;t.style.width=`${o}%`}else t.style.width="0%"}}))},l=()=>{e.getChild("controlBar").getChild("progressControl").getChild("seekBar").el().querySelectorAll(".vjs-chapter-timeline").forEach((e=>{e.remove()}))},n=()=>{const o=t(),s=o?.cues,i=e.getChild("controlBar").getChild("progressControl").getChild("seekBar");if(l(),!s)return;const n=e.duration();Array.from(s).forEach((t=>{const r=t.startTime/n*100,o=t.endTime/n*100,s=new ChapterTimeline(e,{left:`${r}%`,width:o-r+"%"});i.addChild(s)})),r()},a=()=>new Promise((async e=>{let r=0;const o=async()=>{const s=await new Promise((e=>{let r=0;const o=()=>{const s=t();s?e(s):r<12&&(r++,setTimeout(o,250))};o()})),i=s?.cues;i?e(i):r<12&&(r++,setTimeout(o,250))};await o()}));e.on("loadedmetadata",(async()=>{l();try{await a(),n();const t=e.getChild("controlBar").getChild("progressControl");t.on("mousemove",o),t.on("touchmove",o),t.on("mouseleave",s)}catch{}})),e.on("timeupdate",i),e.on("dispose",(()=>{e.off("loadedmetadata",n),e.off("timeupdate",i);const t=e.getChild("controlBar").getChild("progressControl");t.off("mousemove",o),t.off("touchmove",o),t.off("mouseleave",s)}))}videojs.registerComponent("ChapterTimeline",ChapterTimeline),videojs.registerPlugin("chaptersTimeline",chaptersTimeline);